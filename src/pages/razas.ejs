<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razas</title>
    <link rel="stylesheet" href="styles.css">
    <script src="../js/index.js"></script>
</head>

<body>
    <div class="body-container">
        <%- include("../componentes/header.ejs") %>

            <h2 class="main-title">Razas de Gatos</h2>

            <div class="filters">
                <form id="filterForm" action="/razas" method="GET">
                    <input type="text" name="search" placeholder="Buscar raza..." value="<%= search || '' %>">
                    <select name="size">
                        <option value="">Todos los tamaños</option>
                        <option value="pequeño" <%=size==='pequeño' ? 'selected' : '' %>>Pequeño</option>
                        <option value="mediano" <%=size==='mediano' ? 'selected' : '' %>>Mediano</option>
                        <option value="grande" <%=size==='grande' ? 'selected' : '' %>>Grande</option>
                    </select>
                    <select name="coat">
                        <option value="">Todos los pelajes</option>
                        <option value="con pelaje" <%=coat==='con pelaje' ? 'selected' : '' %>>Con pelaje</option>
                        <option value="sin pelaje" <%=coat==='sin pelaje' ? 'selected' : '' %>>Sin pelaje</option>
                    </select>
                    <button class="btn-filtrar" type="submit">Filtrar</button>
                </form>
            </div>

            <div class="cards">
                <% cardsRaza.forEach(card => { %>
                    <%- include("../componentes/cardRaza.ejs", card) %>
                <% }) %>
            </div>

            <%- include("../componentes/footer.ejs") %>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const botonesFavoritos = document.querySelectorAll("#btn-favoritos");
    
            botonesFavoritos.forEach((boton) => {
                boton.addEventListener("click", (event) => {
                    const card = event.target.closest(".card");
    
                    const gato = {
                        breed: card.querySelector("h3").innerText,
                        size: card.querySelector("p:nth-of-type(1)").innerText.replace("Tamaño: ", ""),
                        coat: card.querySelector("p:nth-of-type(2)").innerText.replace("Pelaje: ", ""),
                        image: card.querySelector("img").src.split("/").pop().replace(".jpg", ""),
                        characteristics: card.querySelector(".tags").innerText.split(", ")
                    }
    
                    let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
    
                    if (!favoritos.some(fav => fav.breed === gato.breed)) {
                        favoritos.push(gato);
                        localStorage.setItem("favoritos", JSON.stringify(favoritos));
                        alert("Añadido a favoritos!");
                    } else {
                        alert("Este gato ya está en favoritos!");
                    }
                });
            });
        });
    </script>
</body>

</html>